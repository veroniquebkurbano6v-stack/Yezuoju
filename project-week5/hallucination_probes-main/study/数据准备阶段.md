## 代码功能概述

```python
# 加载训练数据集（可能有多个）
train_datasets: List[TokenizedProbingDataset] = [
    create_probing_dataset(config, tokenizer)  # 为每个配置创建数据集
    for config in training_config.train_dataset_configs  # 遍历所有训练数据配置
]

# 加载评估数据集（可能有多个）
eval_datasets: List[TokenizedProbingDataset] = [
    create_probing_dataset(config, tokenizer)  # 为每个配置创建数据集
    for config in training_config.eval_dataset_configs  # 遍历所有评估数据配置
]
```

## `create_probing_dataset` 的内部逻辑

```python
def create_probing_dataset(config: DatasetConfig, tokenizer) -> TokenizedProbingDataset:
    """创建用于探针训练的数据集"""

    # 1. 从不同来源加载数据
    if config.source == "hf":  # HuggingFace数据集
        dataset = load_dataset_from_hf(config.hf_dataset_name)
    elif config.source == "disk":  # 本地文件
        dataset = load_dataset_from_file(config.file_path)
    elif config.source == "synthetic":  # 合成数据
        dataset = generate_synthetic_data(config.rules)

    # 2. 数据预处理
    processed_dataset = preprocess_dataset(dataset, config)

    # 3. Tokenization（文本转token IDs）
    tokenized_dataset = tokenize_dataset(processed_dataset, tokenizer, config)

    # 4. 创建探测专用数据集
    probing_dataset = TokenizedProbingDataset(
        input_ids=tokenized_dataset["input_ids"],
        attention_masks=tokenized_dataset["attention_mask"],
        labels=tokenized_dataset.get("labels"),  # 幻觉检测标签
        probe_targets=tokenized_dataset.get("probe_targets")  # 探针训练目标
    )

    return probing_dataset
```

## `TokenizedProbingDataset` 的数据结构

```python
class TokenizedProbingDataset(Dataset):
    """探针训练专用数据集"""

    def __init__(self, input_ids, attention_masks, labels=None, probe_targets=None):
        """
        Args:
            input_ids: token IDs [num_samples, seq_len]
            attention_masks: 注意力掩码 [num_samples, seq_len]
            labels: 语言模型标签（用于LM损失）[num_samples, seq_len]
            probe_targets: 探针训练目标 [num_samples, seq_len] 或 [num_samples]
        """
        self.input_ids = input_ids
        self.attention_masks = attention_masks
        self.labels = labels
        self.probe_targets = probe_targets

    def __len__(self):
        return len(self.input_ids)

    def __getitem__(self, idx):
        item = {
            "input_ids": self.input_ids[idx],
            "attention_mask": self.attention_masks[idx],
        }

        if self.labels is not None:
            item["labels"] = self.labels[idx]

        if self.probe_targets is not None:
            item["probe_targets"] = self.probe_targets[idx]

        return item
```

这里的代码就只是加载并预处理了探针的训练和评估数据集
